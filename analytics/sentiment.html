
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- 
    - primary meta tag
  -->
  <title>Doorstopped - Doorstop Education</title>
  <meta name="title" content="Doorstop Education">
  <meta name="description" content="Inspiring students nationwide with research-tested strategies">

  <!-- 
    - favicon
  -->
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

  <!-- 
    - custom css link
      -->

  <link rel="stylesheet" href="/assets/css/style.css">

  <!-- 
    - google font link
  -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=League+Spartan:wght@400;500;600;700;800&family=Poppins:wght@400;500&display=swap"
    rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@2.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>

  <style>
    body {
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        /* height: 100vh; */
        background: #F0DDF0;
        font-family: Poppins;
        flex-direction: column;
    }

    .box, .new-elements .square, .new-elements .rectangle {
            border-radius: 10px;
            background: #FFF;
            box-shadow: 2px 5px 5px 1px rgba(0, 0, 0, 0.25);
            padding: 20px;
            margin: 20px;
            text-align: left;
        }

    .square {
      position: relative;
      display: flex;
      justify-content: center;
      flex-direction: column;
      align-items: center;
      overflow: auto;
    }



    .box {  
        max-width: 90%;
        width: 800px;
        position: relative;
    }

    .button {
            border-radius: 10px;
            position: absolute;
            right: 10px;
            bottom: 10px;
            padding: 10px 20px;
            background: #ccc;
            color: #000000;
            border: none;
            cursor: pointer;
        }

        .new-elements {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            max-width: 80%;
            width: 100%;
            overflow: auto;
            flex-basis: auto;
        }

        .new-elements .square {
            width: calc((100% / 3) - 40px);
            min-width: 150px;
            height: 200px;
        }

        .new-elements .rectangle {
            width: calc(100% - 40px);
            min-height: 200px;
        }

        .fade-in {
        animation: fadeIn .4s ease-in forwards;
        }

        .fade-out {
        animation: fadeOut .4s ease-out forwards;
        }


        .wrapper {
        display: flex;
        }

        nav {
        width: 16.67%; /* 1/6th of the width */
        background: #333;
        color: #fff;
        padding: 20px;
        box-sizing: border-box;
        }

        .main {
        flex-grow: 1;
        background: #E6EDFD;
        min-height: 100vh;
        box-sizing: border-box;
        padding: 20px;
        display: flex;
        flex-wrap: wrap;
        align-items: stretch;
        justify-content: space-around;
        }
        .row {
            display: flex;
            flex-direction: row;
            flex-grow: 1;
            flex-basis: auto;
        }

        .col {
            display: flex;
            flex-direction: column;
        }

        .number {
          font-size: 3em;
          font-weight: bold;
      }

.icon {
    position: absolute;
    top: 10px;
    right: 10px;
    display: flex;
    align-items: center;
}

.icon img {
    width: 20px;
    height: 20px;
}

.percentage {
    margin-left: 5px;
    font-size: 0.8em;
}

.percentage.positive {
    color: green;
}

.percentage.negative {
    color: red;
}

.label {
    font-size: 1.5em;
    font-weight: bold;
}


.header-spacer {
    height: 5em;
    width: 100%;
}

@keyframes fadeIn {
    0% {opacity: 0;}
    100% {opacity: 1;}
}

@keyframes fadeOut {
    0% {opacity: 1;}
    100% {opacity: 0;}
}

canvas {
    width: 100%;
    max-height: 200px;
}

    @media (max-width: 720px) {
        .box {
            max-width: 85%;
            margin: auto;
        }
        .new-elements {
            flex-direction: column;
        }
        .row {
            flex-direction: column;
        }
        .square {
            width: 90%;
        }
        .header-spacer {
            height: 2em;
        }

    }

    
</style>

</head>
<body>
    <header class="header" data-header>
        <div class="container">
    
          <a href="/index.html" class="logo">
            <img src="/assets/images/doors.svg" width="162" height="50" alt="Doorstopped logo">
          </a>
    
          <nav class="navbar" data-navbar>
    
            <div class="wrapper">
              <a href="/index.html" class="logo">
                <img src="/assets/images/doors.svg" width="162" height="50" alt="EduWeb logo">
              </a>
    
              <button class="nav-close-btn" aria-label="close menu" data-nav-toggler>
                <ion-icon name="close-outline" aria-hidden="true"></ion-icon>
              </button>
            </div>
    
            <ul class="navbar-list">
    
              <li class="navbar-item">
                <a href="/analytics/index" class="navbar-link" style="color: black" data-nav-link>Metrics</a>
              </li>
    
              <li class="navbar-item">
                <a href="/analytics/sentiment" class="navbar-link"  style="color: black" data-nav-link>Sentiment</a>
              </li>
    
              <li class="navbar-item">
                <a href="/analytics/design" class="navbar-link" style="color: black" data-nav-link>Create</a>
              </li>
    
              <li class="navbar-item">
                <a href="#download" class="navbar-link" style="color: black" data-nav-link>Download</a>
              </li>
    
            </ul>
    
          </nav>
    
          <div class="header-actions">
    
            <a href="mailto:guzovsky@princeton.edu" class="btn has-before">
              <span class="span">Contact Support</span>
    
              <ion-icon name="arrow-forward-outline" aria-hidden="true"></ion-icon>
            </a>
    
            <button class="header-action-btn" aria-label="open menu" data-nav-toggler>
              <ion-icon name="menu-outline" aria-hidden="true"></ion-icon>
            </button>
    
          </div>
    
          <div class="overlay" data-nav-toggler data-overlay></div>
    
        </div>
      </header>
      <!-- <main>

      </main> -->

<div class="header-spacer"></div>
<div class="new-elements fade-in" id="second">
    
    <div id="max1" class="rectangle fade-in">
      <canvas id="myChart1"></canvas>
    </div>
    <div id="neg1" class="rectangle fade-in">
      <canvas id="myChart-neg"></canvas>
    </div>
    <div id="max2" class="rectangle fade-in">
      <canvas id="myChart2"></canvas>
    </div>
    <div id="max3" class="rectangle fade-in">
      <canvas id="myChart3"></canvas>
    </div>

</div>

  <!-- 
    - custom js link
  -->
  <script src="/assets/js/script.js" defer></script>
  <script>
    let totalEvents = 0;
    fetch('/.netlify/functions/dashboard')
    .then(response => response.json())
    .then(data => {
      // 'data' is the response from your function
      console.log(data);
      let resultDiv = document.getElementById('results');
      let surveyDiv = document.getElementById('survey');
      let excludedNames = ["pageview", "50-swipes-survey-yes", "50-swipes-survey-no"];
      // let surveyNames = ["50-swipes-survey-yes", "50-swipes-survey-no"];

      let filteredData = data.results.filter(item => !excludedNames.includes(item.name));
      totalEvents = filteredData.reduce((acc, curr) => acc + curr.events, 0);

      maxIndicator(filteredData);
      // let surveyData = data.results.filter(item => surveyNames.includes(item.name));
      // not exactly correct meaning right now. this is number of students * avg. number of categories swiped
      // i need a generic swipe event, or just use dashboard pageviews
    })
    .catch((error) => {
      console.error("Error:", error);
    });



    function maxIndicator(data) {
        const sortedData = data.sort((a, b) => b.events - a.events);
        // need to choose how to frame this

        // Get the top 3 categories by visitors
        const top3Items = sortedData.slice(0, 3);
        const bottomItems = sortedData.slice(-1);

        const maxDivs = ['max1', 'max2', 'max3'];
        
        let index = 0;
        top3Items.forEach(item => {
            let s = document.createElement('strong');
            let p = document.createElement('p');
            createChart(index + 1, item.name, item.events, totalEvents / 8);
            switch(item.name) {
            case 'culture':
                s.textContent = "High Engagement with School Culture Doorstops"
                p.textContent = `Students are spending a lot of time on school culture Doorstops, which could mean they feel tension with their peers. Expect students to start trying the peer behavioral interventions we recommend.`; // ${item.visitors} students total.`; 
                break;
            case 'STR':
                p.textContent = `Students are working hard on improving student-teacher relationships, especially with our Anonymous feedback form. That might mean they feel there aren't open communication channels for feedback right now. ${item.visitors} students total.`;
                break;
            case 'self-advocacy':
                p.textContent = `Self-Advocacy: ${item.visitors}`;
                break;
            case 'policy':
                s.textContent = `Strong Interest in School Policy Changes`;
                p.textContent = `Students are spending a lot of time learning about how schools set policy. This might mean they're getting ready to come to the bargaining table with a proposal. Since they're also using a lot of wellbeing Doorstops, expect students to ask for healthier lunch options and more time during lunch block.`; // ${item.visitors} students total.`;  ${item.visitors} students total`;
                break;
            case 'peers':
                p.textContent = `Peers: ${item.visitors}`;
                break;
            case 'SEL-skills':
                s.textContent = `Doorstops are Building SEL Core Competencies`;
                p.textContent = `Students are spending most of their time on learning social-emotional skills. This might help them catch up after COVID - it's awesome they're recognizing this need!`; // ${item.visitors} Students total.`;
                break;
            case 'college-career':
                p.textContent = `College-Career: ${item.visitors}`;
                break;
            case 'wellbeing':
                p.textContent = `Students have interacted a lot with wellbeing doorstops, helping them navigate healthy sleeping, eating, and mental health needs. This is likely the main reason students are reporting feeling happier in school on surveys! `; // ${item.visitors} students total.`; 
                break;
            default:
                console.error('Unexpected category: ', item.name);
            }
            let div = document.getElementById(maxDivs[index]);
            div.insertBefore(p, div.firstChild);
            div.insertBefore(s, div.firstChild);
            index++;
        });

        bottomItems.forEach(item => {
            let s = document.createElement('strong');
            let p = document.createElement('p');
            createChart('-neg', item.name, item.events, totalEvents / 8);
            switch(item.name) {
            case 'culture':
                p.textContent = `Students haven't spend much time on culture Doorstops: ${item.visitors} students total.`;
                break;
            case 'STR':
                p.textContent = `Students haven’t spent much time on student teacher trust Doorstops, so they likely already have strong relationships with their teachers! ${item.visitors} students total.`;
                break;
            case 'self-advocacy':
                p.textContent = `Students haven't spend much time on self-advocacy Doorstops: ${item.visitors} students total.`;
                break;
            case 'policy':
                p.textContent = `Students aren't spending too much time on school policy Doorstops. They must be happy with the way things are run! ${item.visitors} students total.`;
                break;
            case 'peers':
                s.textContent = `Peer relationships are healthy!`
                p.textContent = `Students aren't spending too much time on peer relationship Doorstops. They must be happy with how they're interacting with friends and classmates!`; // ${item.visitors} students total.`;
                break;
            case 'SEL-skills':
                p.textContent = `Students haven't been using SEL skillbuilding Doorstops. If you feel like they're behind on SEL, this might be a sign students aren't aware of that. ${item.visitors} students total`;
                break;
            case 'college-career':
                p.textContent = `Only ${item.visitors} students have used college-career Doorstops. Either your class feels well-prepared or they might need more external support to start thinking about their options post-graduation.`;
                break;
            case 'wellbeing':
                p.textContent = `Only ${item.visitors} students have used wellbeing Doorstops, which cover healthy eating and sleeping, along with basic mental health needs in and around school. That's a good sign!`;
                break;
            default:
                console.error('Unexpected category: ', item.name);
            }
            let div = document.getElementById("neg1");
            div.insertBefore(p, div.firstChild);
            div.insertBefore(s, div.firstChild);
        });
    }


    function createChart(n, category, users, total) {
      let ctx = document.getElementById("myChart" + n).getContext('2d');
      let labelCat = 'Students using ' + category + ' Doorstops';
      const myChart = new Chart(ctx, {
          type: 'bar',
          data: {
              labels: ['Students'],
              datasets: [{
                  label: labelCat,
                  data: [users], // replace with your data
                  backgroundColor: 'rgba(54, 162, 235, 0.4)' // rgba(255, 99, 132, 0.4)'  
              }, {
                  label: 'Average time per category',
                  data: [total], // replace with your data
                  backgroundColor: 'rgba(54, 162, 235, 0.2)' // 'rgba(255, 99, 132, 0.2)' 
              }]
          },
          options: {
              indexAxis: 'y',
              plugins: {
                  legend: {
                      display: false
                  }
              },
              scales: {
                  x: {
                      beginAtZero: true,
                      stacked: true
                  },
                  y: {
                      stacked: true
                  }
              }
          }
      });
    }



  </script>

<!-- 
- ionicon link
-->
<script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>

</body>
</html>