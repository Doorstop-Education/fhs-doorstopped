
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- 
    - primary meta tag
  -->
  <title>Doorstopped - Doorstop Education</title>
  <meta name="title" content="Doorstop Education">
  <meta name="description" content="Inspiring students nationwide with research-tested strategies">

  <!-- 
    - favicon
  -->
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

  <!-- 
    - custom css link
      -->

  <link rel="stylesheet" href="/assets/css/style.css">

  <!-- 
    - google font link
  -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=League+Spartan:wght@400;500;600;700;800&family=Poppins:wght@400;500&display=swap"
    rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@2.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>

  <style>
    body {
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 130vh;
        background: #F0DDF0;
        font-family: Poppins;
    }

    

    .box, .new-elements .square, .new-elements .rectangle {
            border-radius: 10px;
            background: #FFF;
            box-shadow: 2px 5px 5px 1px rgba(0, 0, 0, 0.25);
            padding: 10px;
            margin: 20px;
            text-align: left;
        }

    .square {
      position: relative;
      display: flex;
      justify-content: center;
      flex-direction: column;
      align-items: center;
      overflow: auto;
    }

    .box {  
        max-width: 90%;
        width: 650px;
        position: absolute;
        top: 200px;
        padding: 30px;
    }

    .button {
            border-radius: 10px;
            position: absolute;
            right: 10px;
            bottom: 10px;
            padding: 10px 20px;
            background: #ccc;
            color: #000000;
            border: none;
            cursor: pointer;
        }

        .new-elements {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            max-width: 90%;
            width: 100%;
            flex-basis: auto;
        }

        .new-elements .square {
            width: calc((100% / 3) - 40px);
            min-width: 150px;
            height: 250px;
        }

        .new-elements .rectangle {
            width: calc(100% - 40px);
            min-height: 300px;
        }

        .fade-in {
        animation: fadeIn .3s ease-in forwards;
        }

        .fade-out {
        animation: fadeOut .4s ease-out forwards;
        }


        .wrapper {
        display: flex;
        }

        nav {
        width: 16.67%; /* 1/6th of the width */
        background: #333;
        color: #fff;
        padding: 20px;
        box-sizing: border-box;
        }

        .main {
        flex-grow: 1;
        background: #E6EDFD;
        min-height: 100vh;
        box-sizing: border-box;
        padding: 20px;
        display: flex;
        flex-wrap: wrap;
        align-items: stretch;
        justify-content: space-around;
        }
        .row {
            display: flex;
            flex-direction: row;
            flex-grow: 1;
            flex-basis: auto;
        }

        .col {
            display: flex;
            flex-direction: column;
        }

        .number {
          font-size: 5em;
          font-weight: bold;
      }

.icon {
    position: absolute;
    top: 20px;
    right: -60px;
    display: flex;
    max-height: 40px;
}

.icon img {
    width: 30px;
    height: 30px;
}

.icon img.positive {
  color: green;
}

.icon img.negative {
    color: red;
}
.top-section {
    position: relative;
    display: flex;
    flex-direction: row;
    justify-content: right;
}

.percentage {
    margin-left: 5px;
    font-size: 1em;
    align-self: flex-start;
}

.percentage.positive {
    color: green;
}

.percentage.negative {
    color: red;
}

.label {
    font-size: 1.3em;
    font-weight: bold;
    text-align: center;
}

.header-spacer {
    height: 15em;
    width: 100%;
}

@keyframes fadeIn {
    0% {opacity: 0;}
    100% {opacity: 1;}
}

@keyframes fadeOut {
    0% {opacity: 1;}
    100% {opacity: 0;}
}

canvas {
  width: 100%;
  min-height: 200px;
}

#intro-img {
  width: 150px;
  height: 150px;
}

    @media (max-width: 720px) {
        body {
          height: 170vh;
          align-items: flex-start;
        }
        .box {
            max-width: 85%;
            margin: auto;
        }
        .new-elements {
            flex-direction: column;
        }
        .row {
            flex-direction: column;
        }
        .new-elements .square {
            width: 90%;
        }
        .header-spacer {
            height: 2.5em;
        }
    }

    
</style>

</head>
<body>
    <header class="header" data-header>
        <div class="container">
    
          <a href="/index.html" class="logo">
            <img src="/assets/images/doors.svg" width="162" height="50" alt="Doorstopped logo">
          </a>
    
          <nav class="navbar" data-navbar>
    
            <div class="wrapper">
              <a href="/index.html" class="logo">
                <img src="/assets/images/doors.svg" width="162" height="50" alt="EduWeb logo">
              </a>
    
              <button class="nav-close-btn" aria-label="close menu" data-nav-toggler>
                <ion-icon name="close-outline" aria-hidden="true"></ion-icon>
              </button>
            </div>
    
            <ul class="navbar-list">
    
              <li class="navbar-item">
                <a href="/analytics/index" class="navbar-link" style="color: black" data-nav-link>Metrics</a>
              </li>
    
              <li class="navbar-item">
                <a href="/analytics/sentiment" class="navbar-link"  style="color: black" data-nav-link>Sentiment</a>
              </li>
    
              <li class="navbar-item">
                <a href="/analytics/design" class="navbar-link" style="color: black" data-nav-link>Create</a>
              </li>
    
              <li class="navbar-item">
                <a href="#download" class="navbar-link" style="color: black" data-nav-link>Download</a>
              </li>
    
            </ul>
    
          </nav>
    
          <div class="header-actions">
    
            <a href="mailto:guzovsky@princeton.edu" class="btn has-before">
              <span class="span">Contact Support</span>
    
              <ion-icon name="arrow-forward-outline" aria-hidden="true"></ion-icon>
            </a>
    
            <button class="header-action-btn" aria-label="open menu" data-nav-toggler>
              <ion-icon name="menu-outline" aria-hidden="true"></ion-icon>
            </button>
    
          </div>
    
          <div class="overlay" data-nav-toggler data-overlay></div>
    
        </div>
      </header>
      <!-- <main>

      </main> -->
<div class="box" id="onboard">
    <h1>How are students interacting with Doorstops?</h1>
    <p>Welcome to our Doorstop Dashboard, with data-driven reporting on how students feel about school, plus live-updating survey data on your chosen metrics.</p>
    <br><br>
    <!-- <img src="/assets/images/classroomempty.jpg" id="intro-img" alt="Sample image"> -->
    <button id="engage" class="button">Show me data!</button>

</div>

<div class="new-elements fade-in" id="second" style="display: none;">
  <div class="header-spacer"></div>
    <div class="row">
        <div id="survey" class="square">
          <div class="top-section">
            <span class="number">85</span>
            <div class="icon positive">
                <img src="/assets/svg/upicon.svg" alt="down-icon" />
                <span class="percentage positive">15%</span>
            </div>
        </div>
        <div class="label">
            <span>Students feel safer in school, 201 surveyed</span>
        </div>
        </div>
        <div id="results" class="square">
          <div class="top-section">
            <span class="number">170</span>
            <div class="icon positive">
                <img src="/assets/svg/upicon.svg" alt="down-icon" />
                <span class="percentage positive">19%</span>
            </div>
          </div>
          <div class="label">
              <span>Students used 50+ Doorstops this week</span>
          </div>
        </div>
        <div id="culture" class="square">
          <div class="top-section">
            <span class="number">145</span>
            <div class="icon positive">
                <img src="/assets/svg/upicon.svg" alt="down-icon" />
                <span class="percentage positive">50%</span>
            </div>
          </div>
          <div class="label">
              <span>Students are more excited to attend class</span>
              <span id="temp-filler"></span>
          </div>
        </div>
    </div>
    <div class="rectangle">
      <div id="loading-chart" style="width: 100%; height: 100%; text-align: center; vertical-align: middle; font-size: 25px;">Chart loading!</div>
      <canvas id="myChart"></canvas>
    </div>
</div>

  <!-- 
    - custom js link
  -->
  <script src="/assets/js/script.js" defer></script>
  <script>
    $(document).ready(function(){
      if (localStorage.getItem('cache') === 'yes') {
            //  Check if page has been viewed
              $('.box').css("display", "none");
              $("body").css("background", "#E6EDFD");
              document.querySelector('#second').style.display = "flex";
            } else {
              localStorage.setItem('cache', 'yes');
            }
        $(".button").click(function(){
            document.querySelector('#onboard').classList.add("fade-out");
            $(".box").css("display", "none");
            $("body").css("background", "#E6EDFD");
            document.querySelector('#second').style.display = "flex";
            setTimeout(() => {
                document.querySelector('#second').classList.remove("fade-in");
            }, 400);
        });
    });
</script>
  <script>
    fetch('/.netlify/functions/dashboard')
    .then(response => response.json())
    .then(data => {
      // 'data' is the response from your function
      console.log(data);
      let resultDiv = document.getElementById('results');
      let surveyDiv = document.getElementById('survey');
      let excludedNames = ["pageview", "50-swipes-survey-yes", "50-swipes-survey-no"];
      let surveyNames = ["50-swipes-survey-yes", "50-swipes-survey-no"];

      let filteredData = data.results.filter(item => !excludedNames.includes(item.name));
      let surveyData = data.results.filter(item => surveyNames.includes(item.name));
      console.log(surveyData);
      surveyData.forEach(item => {
        let p = document.createElement('p');
        p.textContent = `${item.name}: ${item.visitors}`;
        surveyDiv.appendChild(p); 
      })
      filteredData.forEach(item => {
        let p = document.createElement('p');
        p.textContent = `${item.name}: ${item.visitors}`;
        resultDiv.appendChild(p);
      });
      const totalEvents = filteredData.reduce((acc, curr) => acc + curr.events, 0);
      document.getElementById('temp-filler').innerText = `Total Swipes Right: ${totalEvents}`;
    })
    .catch((error) => {
      console.error("Error:", error);
    });
  </script>
  <script>
    fetch('/.netlify/functions/weekly')
  .then(response => response.json())
  .then(data => {
    // Prepare the data for the chart
    const labels = data.map(item => {
      const date = new Date(item.day);
      return date.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' });
    });
    const visitors = data.map(item => item.data.results.visitors.value);
    // const sample = [75, 83, 104, 85, 155, 177, 183, 120, 82, 109, 111, 67, 129, 190, 144];
    
    // Create the chart
    const ctx = document.getElementById('myChart').getContext('2d');
    const myChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: labels,
        datasets: [{
          label: 'Unique student visitors',
          data: visitors, // sample
          backgroundColor: 'rgba(233, 30, 99, 0.2)',
          borderColor: 'rgba(233, 30, 99, 1)',
          borderWidth: 3
        }]
      },
      options: {
        responsive: true,
        plugins: {
          title: {
            display: true,
            text: 'Daily Engagemet: Number of Students using Doorstops',
            font: {
              size: 30,
              family: 'Poppins'
            }
          },
          legend: {
            display: true,
            position: 'bottom'
          },
        },
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });
    let loading = document.getElementById('loading-chart');
    loading.style.display = "none";
  })
  .catch(error => console.error('Error:', error));
  
  </script>

<!-- 
- ionicon link
-->
<script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>

</body>
</html>